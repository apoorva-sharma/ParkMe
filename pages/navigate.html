<!DOCTYPE html>
<html>
<head>
	<title>ParkMe</title>
	<link rel="stylesheet" type="text/css" href="css/min.css" />
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/lot.css" />
	<script type="text/javascript" src="js/jquery.js" > </script>

	<script type="text/javascript">
		var lotID = 1;
		var evtSource = new EventSource("status?"+lotID);

		var lot;  //most recent lot from /lot?1
		var plan; //most recent plan     /plan?1
		var nRow = 9;
		var nCol = 20;

		var canvasHeight = 500;
		var canvasWidth  = 900;

		var cellHeight = 5;
		var cellWidth = 5;

		var lotDiv;

		function getPath() {
			console.log("getting lot");
			$.getJSON('path?'+lotID, function(data) {
				path = data;
				drawPath();
			});
		}

		function getLot() {
			console.log("getting lot");
			$.getJSON('lot?'+lotID, function(data) {
				lot = data;
				drawLot();
			});
			console.log("got lot");
		};

		function init() {
			getLot();

			lotDiv = document.getElementById("lot");
			console.log("hello");

			var widthPercentage = 0.99/(nCol+1)*100;
			//make every div
			for(var i = 0; i < nRow; i++) {
				var rDiv = document.createElement('div');
				rDiv.id = "row"+i;
				rDiv.className = "lotrow";


				// make a row
				for(var j = 0; j < nCol; j++) {
					var cDiv = document.createElement('div');
					cDiv.id = i+'-'+j;
					cDiv.className = "spot";

					$(cDiv).width(widthPercentage+"%");
					rDiv.appendChild(cDiv);


				}
				var clearDiv = document.createElement('div');
				clearDiv.className = "clearrow";
				rDiv.appendChild(clearDiv);

				lotDiv.appendChild(rDiv);
			}

			drawLot();
		}

		function drawLot() {
			for(var r = 0; r < nRow; r++) {
				for(var c = 0; c < nCol; c++) {
					var id = r+'-'+c;

					if(!lot) {
						console.log("no lot...");
						return; 
					}
					console.log(lot[r][c]);
					switch(lot[r][c]) {
						case 0:
							$('#'+id).addClass('free');
							$('#'+id).removeClass('taken');
							break;
						case 1:
							$('#'+id).addClass('taken');
							$('#'+id).removeClass('free');
							break;
					}

					if(lot[r][c] == '-1') {
						$('#'+id).addClass('road');
					}
				}
			}
		}

		$(document).ready(init);

		evtSource.onmessage = function(e) {
			console.log("changed!");

			getLot();
		};

	</script>
</head>
<body>
<div class="row">
	<div class="col c2">&nbsp;</div>
	<div class="col c8 content">
		<h1 class="head">Park<span class="light">Me</span></h1>
		<div id="lot">

		</div>
		</canvas>
	</div>
	<div class="col c2">&nbsp;</div>
</div>
</body>
</html>